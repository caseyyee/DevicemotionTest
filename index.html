<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<body>
<b>Devicemotion events</b>

<br/><br/>
Performance.now()
<div id="performance"></div>

delta:
<div id="performance-delta"></div>

<br/><br/>
DeviceMotionEvent.timestamp
<div id="timestamp"></div>

delta:
<div id="delta"></div>

delta averaged:
<div id="delta-average"></div>

<br/><br/>
DeviceMotionEvent.accelerationIncludingGravity
<div id="accel"></div>

<br/><br/>
DeviceMotionEvent.rotationRate
<div id="rotationRate"></div>

<br/><br/>
DeviceMotionEvent.interval
<div id="interval"></div>

</body>
<script>
var previousPerformance;
var previousTimestamp;
var performanceEl = document.getElementById('performance');
var performanceDeltaEl = document.getElementById('performance-delta');
var timestampEl = document.getElementById('timestamp');
var deltaEl = document.getElementById('delta');
var deltaAverageEl = document.getElementById('delta-average');
var acceleration = document.getElementById('accel');
var rotation = document.getElementById('rotationRate');
var intervalContainer = document.getElementById('interval');
var isFirefoxAndroid = navigator.userAgent.indexOf('Firefox') !== -1 && navigator.userAgent.indexOf('Android') !== -1;

var deltaArray = [];
var deltaSampleSize = 100;

window.addEventListener('devicemotion', function(deviceMotion) {
  // performance.now()
  var perf = performance.now();
  var perfDelta = perf - previousPerformance;
  previousPerformance = perf;
  performanceEl.innerHTML = perf;
  performanceDeltaEl.innerHTML = perfDelta;

  // devicemotion timestamp
  var timestamp = deviceMotion.timeStamp;
  if (isFirefoxAndroid) {
    timestamp /= 1000;
  }
  timestampEl.innerHTML = timestamp;

  var delta = timestamp - previousTimestamp;
  previousTimestamp = timestamp;
  deltaEl.innerHTML = delta;

  deltaArray.push(delta)
  if (deltaArray.length > deltaSampleSize) {
    deltaArray.shift();
  };

  var deltaSum = deltaArray.reduce(function(a, b) { return a + b; });
  var deltaAverage = deltaSum/deltaArray.length;
  deltaAverageEl.innerHTML = deltaAverage;

  // devicemotion properties.
  var accGravity = deviceMotion.accelerationIncludingGravity;
  acceleration.innerHTML = accGravity.x + '<br/>'
  						+ accGravity.y + '<br/>'
  						+ accGravity.z + '<br/>';

  var rotRate = deviceMotion.rotationRate;
  rotation.innerHTML = rotRate.alpha/100 + '<br/>'
  						+ rotRate.beta/100 + '<br/>'
  						+ rotRate.gamma/100 + '<br/>';

  intervalContainer.innerHTML = deviceMotion.interval;
});
</script>
</html>

